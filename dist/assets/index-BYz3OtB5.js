(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();class c{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.audioCtx=null,this.analyser=null,this.dataArray=null,this.source=null,this.isPlaying=!1,this.canvas.width=this.canvas.offsetWidth,this.canvas.height=150,window.addEventListener("resize",()=>{this.canvas.width=this.canvas.offsetWidth,this.updateVisualizer()})}initialize(t){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=256;const e=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(e),this.source=this.audioCtx.createMediaElementSource(t),this.source.connect(this.analyser),this.analyser.connect(this.audioCtx.destination)}updateVisualizer(){if(!this.isPlaying)return;requestAnimationFrame(()=>this.updateVisualizer()),this.analyser.getByteFrequencyData(this.dataArray),this.ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--primary-color"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const t=this.canvas.width/this.dataArray.length*2.5;let e=0,s=0,a=0;for(let i=0;i<this.dataArray.length;i++){const o=this.dataArray[i];a+=o,o>this.dataArray[s]&&(s=i);const n=this.ctx.createLinearGradient(0,0,0,this.canvas.height);n.addColorStop(0,"#4a90e2"),n.addColorStop(1,"#1a3a4a"),this.ctx.fillStyle=n,this.ctx.fillRect(e,this.canvas.height-o/2,t,o/2),e+=t+1}return{peakFrequency:s*(this.audioCtx.sampleRate/2)/this.dataArray.length,averageVolume:a/this.dataArray.length}}start(){this.isPlaying=!0,this.updateVisualizer()}stop(){this.isPlaying=!1}getAudioData(){if(!this.analyser||!this.dataArray)return null;this.analyser.getByteFrequencyData(this.dataArray);let t=0,e=0;for(let s=0;s<this.dataArray.length;s++)t+=this.dataArray[s],this.dataArray[s]>this.dataArray[e]&&(e=s);return{peakFrequency:e*(this.audioCtx.sampleRate/2)/this.dataArray.length,averageVolume:t/this.dataArray.length}}}const d=["Narael","Vorrin","Selkai","Drumeth","Olaan","Caelo","Taruin","Fenja","Erelas"],u={names:d},g=["Raeth's Deep","The Shattered Reef","Olaan's Cry","Caelo's Rise","Narael's Fall","The Black Shoal","Driftwater","Ghost Trench"],p={locations:g},m=["his fluke low","her call fading","at dawn","when the current turned","as silence fell","beneath the storm","in mourning"],y={actions:m};class f{constructor(){this.names=u.names,this.locations=p.locations,this.actions=y.actions}pick(t){return t[Math.floor(Math.random()*t.length)]}getToneTag(t){return t>600?"high voice":t<200?"deep echo":"steady tone"}getMoodTag(t){return t>100?"with grief":t<30?"with peace":"with memory"}getAnalystAction(t,e){const s=["pattern detected","sequence complete","signal analyzed","data processed","transmission received"];return this.pick(s)}generatePhrase(t,e,s,a="emotionalist"){const i=this.pick(this.names),o=this.pick(this.locations),n=this.getToneTag(t),h=this.getMoodTag(e);let l;return a==="analyst"?l=this.getAnalystAction(t,e):l=this.pick(this.actions),`${i}, at ${o}, ${l} (${n}, ${h}) [${Math.round(s)}s]`}}class L{constructor(t){this.logList=t,this.phrases=JSON.parse(localStorage.getItem("bealePhrases")||"[]"),this.renderLog()}addPhrase(t){this.phrases.push({text:t,timestamp:new Date().toISOString()}),this.saveToStorage(),this.renderLog()}clearLog(){this.phrases=[],this.saveToStorage(),this.renderLog()}copyToClipboard(){const t=this.phrases.map(e=>e.text).join(`
`);navigator.clipboard.writeText(t)}exportAsTxt(){const t=this.phrases.map(e=>e.text).join(`
`);this.downloadFile(t,"beale-log.txt","text/plain")}exportAsJson(){const t=JSON.stringify(this.phrases,null,2);this.downloadFile(t,"beale-log.json","application/json")}downloadFile(t,e,s){const a=new Blob([t],{type:s}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}saveToStorage(){localStorage.setItem("bealePhrases",JSON.stringify(this.phrases))}renderLog(){this.logList.innerHTML="",this.phrases.forEach(t=>{const e=document.createElement("li");e.textContent=t.text,this.logList.appendChild(e)})}}class x{constructor(){this.audioFile=document.getElementById("audioFile"),this.audio=document.getElementById("audio"),this.canvas=document.getElementById("visualizer"),this.phraseOutput=document.getElementById("phrase"),this.logList=document.getElementById("logList"),this.emotionalistMode=document.getElementById("emotionalistMode"),this.analystMode=document.getElementById("analystMode"),this.copyLog=document.getElementById("copyLog"),this.exportTxt=document.getElementById("exportTxt"),this.exportJson=document.getElementById("exportJson"),this.clearLog=document.getElementById("clearLog"),this.audioProcessor=new c(this.canvas),this.phraseGenerator=new f,this.logManager=new L(this.logList),this.currentMode="emotionalist",this.lastLoggedTime=0,this.logInterval=4,this.bindEvents()}bindEvents(){this.audioFile.addEventListener("change",t=>this.handleFileSelect(t)),this.audio.addEventListener("play",()=>{this.audioProcessor.initialize(this.audio),this.audioProcessor.start(),this.lastLoggedTime=0}),this.audio.addEventListener("pause",()=>{this.audioProcessor.stop()}),this.emotionalistMode.addEventListener("click",()=>this.setMode("emotionalist")),this.analystMode.addEventListener("click",()=>this.setMode("analyst")),this.copyLog.addEventListener("click",()=>this.logManager.copyToClipboard()),this.exportTxt.addEventListener("click",()=>this.logManager.exportAsTxt()),this.exportJson.addEventListener("click",()=>this.logManager.exportAsJson()),this.clearLog.addEventListener("click",()=>this.logManager.clearLog()),requestAnimationFrame(()=>this.update())}handleFileSelect(t){const e=t.target.files[0];if(!e)return;const s=URL.createObjectURL(e);this.audio.src=s}setMode(t){this.currentMode=t,this.emotionalistMode.classList.toggle("active",t==="emotionalist"),this.analystMode.classList.toggle("active",t==="analyst")}update(){if(requestAnimationFrame(()=>this.update()),!this.audioProcessor.isPlaying)return;const t=this.audioProcessor.getAudioData();if(!t)return;const e=this.audio.currentTime;if(e-this.lastLoggedTime>=this.logInterval){const s=this.phraseGenerator.generatePhrase(t.peakFrequency,t.averageVolume,e,this.currentMode);this.phraseOutput.textContent=s,this.logManager.addPhrase(s),this.lastLoggedTime=e}}}document.addEventListener("DOMContentLoaded",()=>{new x});
